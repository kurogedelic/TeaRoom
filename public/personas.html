<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TeaRoom - Persona Management</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 20px;
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        .nav-bar {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            justify-content: center;
        }
        
        .nav-btn {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            text-decoration: none;
            border-radius: 20px;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }
        
        .nav-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }
        
        .management-card {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 40px;
            margin-bottom: 30px;
            animation: slideIn 0.5s ease-out;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .section-title {
            font-size: 2em;
            margin-bottom: 30px;
            color: #667eea;
        }
        
        .persona-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .persona-card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            border: 2px solid #e0e0e0;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .persona-card:hover {
            border-color: #667eea;
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.2);
        }
        
        .persona-name {
            font-size: 1.3em;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 15px;
        }
        
        .persona-info {
            margin-bottom: 10px;
        }
        
        .persona-info-label {
            font-weight: bold;
            color: #666;
            margin-right: 10px;
        }
        
        .persona-info-value {
            color: #333;
        }
        
        .trait-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin: 15px 0;
        }
        
        .trait-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 12px;
            background: white;
            border-radius: 8px;
            font-size: 0.9em;
        }
        
        .trait-name {
            color: #666;
        }
        
        .trait-score {
            font-weight: bold;
            color: #667eea;
        }
        
        .persona-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            font-size: 0.9em;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            text-align: center;
        }
        
        .btn-view {
            background: #3498db;
            color: white;
            flex: 1;
        }
        
        .btn-edit {
            background: #f39c12;
            color: white;
            flex: 1;
        }
        
        .btn-delete {
            background: #e74c3c;
            color: white;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            opacity: 0.9;
        }
        
        .add-persona-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 200px;
            cursor: pointer;
            border: 2px dashed rgba(255, 255, 255, 0.5);
        }
        
        .add-persona-card:hover {
            border-color: white;
            transform: translateY(-5px);
        }
        
        .add-icon {
            font-size: 3em;
            margin-bottom: 15px;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            background: white;
            margin: 5% auto;
            padding: 40px;
            border-radius: 20px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }
        
        .modal-title {
            font-size: 1.5em;
            color: #667eea;
        }
        
        .close {
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            color: #aaa;
        }
        
        .close:hover {
            color: #000;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
        }
        
        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s ease;
        }
        
        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .trait-slider-group {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin: 20px 0;
        }
        
        .trait-slider {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
        }
        
        .trait-slider-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-weight: bold;
        }
        
        .trait-slider-input {
            width: 100%;
            margin-bottom: 5px;
        }
        
        .trait-description {
            font-size: 0.8em;
            color: #666;
            text-align: center;
        }
        
        .modal-actions {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #e0e0e0;
        }
        
        .btn-primary {
            background: #667eea;
            color: white;
            padding: 12px 24px;
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
            padding: 12px 24px;
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }
        
        .empty-icon {
            font-size: 4em;
            margin-bottom: 20px;
            opacity: 0.5;
        }
        
        .icon-picker {
            display: grid;
            grid-template-columns: auto 1fr;
            gap: 15px;
            align-items: center;
        }
        
        .icon-display {
            width: 60px;
            height: 60px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #f8f9fa;
            overflow: hidden;
        }
        
        .icon-display img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 8px;
        }
        
        .icon-display:hover {
            border-color: #667eea;
            transform: scale(1.05);
        }
        
        .upload-section {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .upload-btn {
            padding: 8px 16px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s ease;
        }
        
        .upload-btn:hover {
            background: #5a67d8;
        }
        
        .or-divider {
            text-align: center;
            color: #666;
            font-size: 0.9em;
            margin: 10px 0;
            position: relative;
        }
        
        .or-divider::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background: #e0e0e0;
            z-index: 1;
        }
        
        .or-divider span {
            background: white;
            padding: 0 10px;
            position: relative;
            z-index: 2;
        }
        
        .icon-grid {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 8px;
            max-height: 200px;
            overflow-y: auto;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            background: #f8f9fa;
            margin-top: 10px;
        }
        
        .icon-option {
            width: 40px;
            height: 40px;
            border: 2px solid transparent;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }
        
        .icon-option:hover {
            border-color: #667eea;
            transform: scale(1.1);
        }
        
        .icon-option.selected {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }
        
        .persona-icon {
            font-size: 1.5em;
            margin-right: 10px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>🎭 TeaRoom Persona Management</h1>
        <p>Create and manage AI personalities for your conversations</p>
    </div>
    
    <div class="container">
        <div class="nav-bar">
            <a href="/" class="nav-btn">🏠 Home</a>
            <a href="/wizard" class="nav-btn">🚀 Start Conversation</a>
            <a href="/chat" class="nav-btn">💬 View Chat</a>
        </div>
        
        <div class="management-card">
            <h2 class="section-title">Personas</h2>
            <div class="persona-grid" id="personaGrid">
                <!-- Personas will be loaded here -->
            </div>
        </div>
    </div>
    
    <!-- Create/Edit Persona Modal -->
    <div id="personaModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">Create New Persona</h2>
                <span class="close" onclick="closeModal()">&times;</span>
            </div>
            
            <form id="personaForm">
                <div class="form-group">
                    <label class="form-label">Name *</label>
                    <input type="text" id="personaName" class="form-input" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Gender</label>
                    <select id="personaGender" class="form-select">
                        <option value="Male">Male</option>
                        <option value="Female">Female</option>
                        <option value="Non-binary">Non-binary</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Icon/Avatar</label>
                    <div class="icon-picker">
                        <div class="icon-display" id="selectedIcon">👤</div>
                        <div class="upload-section">
                            <input type="file" id="avatarUpload" accept="image/*" style="display: none;" onchange="handleImageUpload(event)">
                            <button type="button" class="upload-btn" onclick="document.getElementById('avatarUpload').click()">
                                📁 Upload Image
                            </button>
                            <div class="or-divider"><span>OR</span></div>
                            <button type="button" class="upload-btn" onclick="toggleIconGrid()">
                                😊 Choose Emoji
                            </button>
                            <div id="iconGrid" class="icon-grid" style="display: none;"></div>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Introduction</label>
                    <textarea id="personaIntroduction" class="form-textarea" placeholder="Brief introduction about this persona..."></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Big Five Personality Traits</label>
                    <div class="trait-slider-group">
                        <div class="trait-slider">
                            <div class="trait-slider-label">
                                <span>Extraversion</span>
                                <span id="extraversionValue">3</span>
                            </div>
                            <input type="range" id="extraversion" class="trait-slider-input" min="1" max="5" value="3" oninput="updateSliderValue('extraversion')">
                            <div class="trait-description">Reserved ← → Social</div>
                        </div>
                        
                        <div class="trait-slider">
                            <div class="trait-slider-label">
                                <span>Agreeableness</span>
                                <span id="agreeablenessValue">3</span>
                            </div>
                            <input type="range" id="agreeableness" class="trait-slider-input" min="1" max="5" value="3" oninput="updateSliderValue('agreeableness')">
                            <div class="trait-description">Analytical ← → Cooperative</div>
                        </div>
                        
                        <div class="trait-slider">
                            <div class="trait-slider-label">
                                <span>Conscientiousness</span>
                                <span id="conscientiousnessValue">3</span>
                            </div>
                            <input type="range" id="conscientiousness" class="trait-slider-input" min="1" max="5" value="3" oninput="updateSliderValue('conscientiousness')">
                            <div class="trait-description">Spontaneous ← → Organized</div>
                        </div>
                        
                        <div class="trait-slider">
                            <div class="trait-slider-label">
                                <span>Neuroticism</span>
                                <span id="neuroticismValue">3</span>
                            </div>
                            <input type="range" id="neuroticism" class="trait-slider-input" min="1" max="5" value="3" oninput="updateSliderValue('neuroticism')">
                            <div class="trait-description">Stable ← → Sensitive</div>
                        </div>
                        
                        <div class="trait-slider">
                            <div class="trait-slider-label">
                                <span>Openness</span>
                                <span id="opennessValue">3</span>
                            </div>
                            <input type="range" id="openness" class="trait-slider-input" min="1" max="5" value="3" oninput="updateSliderValue('openness')">
                            <div class="trait-description">Practical ← → Creative</div>
                        </div>
                    </div>
                </div>
                
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Persona</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- View Persona Modal -->
    <div id="viewModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="viewModalTitle">Persona Details</h2>
                <span class="close" onclick="closeViewModal()">&times;</span>
            </div>
            <div id="viewModalContent">
                <!-- Content will be populated by JavaScript -->
            </div>
        </div>
    </div>
    
    <script>
        let personas = [];
        let editingPersona = null;
        
        // Load personas on page load
        async function loadPersonas() {
            try {
                const response = await fetch('/api/personas');
                personas = await response.json();
                renderPersonas();
            } catch (error) {
                console.error('Failed to load personas:', error);
            }
        }
        
        function renderPersonas() {
            const grid = document.getElementById('personaGrid');
            grid.innerHTML = '';
            
            // Add "Create New" card
            const addCard = document.createElement('div');
            addCard.className = 'persona-card add-persona-card';
            addCard.innerHTML = `
                <div class="add-icon">+</div>
                <div>Create New Persona</div>
            `;
            addCard.onclick = () => openCreateModal();
            grid.appendChild(addCard);
            
            if (personas.length === 0) {
                const emptyState = document.createElement('div');
                emptyState.className = 'empty-state';
                emptyState.innerHTML = `
                    <div class="empty-icon">🎭</div>
                    <h3>No personas yet</h3>
                    <p>Create your first persona to get started!</p>
                `;
                grid.appendChild(emptyState);
                return;
            }
            
            // Add persona cards
            personas.forEach(persona => {
                const card = createPersonaCard(persona);
                grid.appendChild(card);
            });
        }
        
        function createPersonaCard(persona) {
            const card = document.createElement('div');
            card.className = 'persona-card';
            
            // Get icon (default to generic person icon if not set)
            const icon = persona.icon || '👤';
            
            // Check if icon is an image URL or emoji
            const iconHtml = icon.startsWith('/uploads/') 
                ? `<img src="${icon}" alt="Avatar" style="width: 24px; height: 24px; border-radius: 50%; object-fit: cover; margin-right: 10px;">`
                : `<span class="persona-icon">${icon}</span>`;
            
            card.innerHTML = `
                <div class="persona-name">
                    ${iconHtml}
                    ${persona.name}
                </div>
                <div class="persona-info">
                    <span class="persona-info-label">Type:</span>
                    <span class="persona-info-value">AI Persona</span>
                </div>
                <div class="persona-actions">
                    <button class="btn btn-view" onclick="viewPersona('${persona.name}')">View</button>
                    <button class="btn btn-edit" onclick="editPersona('${persona.name}')">Edit</button>
                    <button class="btn btn-delete" onclick="deletePersona('${persona.name}')">Delete</button>
                </div>
            `;
            
            return card;
        }
        
        function openCreateModal() {
            editingPersona = null;
            document.getElementById('modalTitle').textContent = 'Create New Persona';
            document.getElementById('personaForm').reset();
            resetSliders();
            document.getElementById('personaModal').style.display = 'block';
        }
        
        function editPersona(name) {
            // Note: This is a simplified edit - in a real implementation,
            // you would fetch the persona data and populate the form
            editingPersona = name;
            document.getElementById('modalTitle').textContent = `Edit ${name}`;
            document.getElementById('personaName').value = name;
            document.getElementById('personaModal').style.display = 'block';
        }
        
        async function viewPersona(name) {
            try {
                // Try to read the persona's PROFILE.md file
                const response = await fetch(`/api/persona/${name}`);
                let content = '';
                
                if (response.ok) {
                    const data = await response.json();
                    content = `
                        <div class="persona-info">
                            <div class="persona-info-label">Name:</div>
                            <div class="persona-info-value">${name}</div>
                        </div>
                        <div style="margin-top: 20px;">
                            <div class="persona-info-label">Profile:</div>
                            <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-top: 10px; white-space: pre-wrap;">${data.profile || 'No profile data available'}</div>
                        </div>
                    `;
                } else {
                    content = `
                        <div class="persona-info">
                            <div class="persona-info-label">Name:</div>
                            <div class="persona-info-value">${name}</div>
                        </div>
                        <div style="margin-top: 20px; padding: 20px; background: #f8f9fa; border-radius: 10px; color: #666;">
                            Profile data not available. This persona exists but detailed information cannot be loaded.
                        </div>
                    `;
                }
                
                document.getElementById('viewModalTitle').textContent = `${name} - Details`;
                document.getElementById('viewModalContent').innerHTML = content;
                document.getElementById('viewModal').style.display = 'block';
            } catch (error) {
                console.error('Error loading persona details:', error);
            }
        }
        
        async function deletePersona(name) {
            if (confirm(`Are you sure you want to delete the persona "${name}"? This action cannot be undone.`)) {
                try {
                    const response = await fetch(`/api/personas/${name}`, {
                        method: 'DELETE'
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        alert('Persona deleted successfully!');
                        loadPersonas(); // Reload the persona list
                    } else {
                        alert('Error deleting persona: ' + result.error);
                    }
                } catch (error) {
                    console.error('Error deleting persona:', error);
                    alert('Error deleting persona: ' + error.message);
                }
            }
        }
        
        function closeModal() {
            document.getElementById('personaModal').style.display = 'none';
        }
        
        function closeViewModal() {
            document.getElementById('viewModal').style.display = 'none';
        }
        
        function updateSliderValue(traitName) {
            const slider = document.getElementById(traitName);
            const valueSpan = document.getElementById(traitName + 'Value');
            valueSpan.textContent = slider.value;
        }
        
        function resetSliders() {
            ['extraversion', 'agreeableness', 'conscientiousness', 'neuroticism', 'openness'].forEach(trait => {
                document.getElementById(trait).value = 3;
                document.getElementById(trait + 'Value').textContent = '3';
            });
        }
        
        // Icon selection functionality
        const availableIcons = [
            '👤', '👥', '🤖', '👨', '👩', '👦', '👧', '🧔', '👨‍💼', '👩‍💼',
            '👨‍🎓', '👩‍🎓', '👨‍🏫', '👩‍🏫', '👨‍🔬', '👩‍🔬', '👨‍💻', '👩‍💻',
            '👨‍🎨', '👩‍🎨', '👨‍🍳', '👩‍🍳', '👨‍⚕️', '👩‍⚕️', '🦸‍♂️', '🦸‍♀️',
            '🧙‍♂️', '🧙‍♀️', '🧚‍♂️', '🧚‍♀️', '🧞‍♂️', '🧞‍♀️', '🎭', '🎪', '🎨',
            '📚', '🔬', '💼', '🎵', '🎮', '⚽', '🏀', '🎾', '🏆', '🌟',
            '💫', '⭐', '🌙', '☀️', '🌈', '🔥', '💎', '🎯', '🚀', '⚡',
            '🦋', '🐱', '🐶', '🦊', '🐺', '🦁', '🐯', '🐨', '🐼', '🦄'
        ];
        
        let selectedPersonaIcon = '👤';
        let selectedIconType = 'emoji'; // 'emoji' or 'image'
        
        function initializeIconGrid() {
            const iconGrid = document.getElementById('iconGrid');
            iconGrid.innerHTML = '';
            
            availableIcons.forEach(icon => {
                const iconOption = document.createElement('div');
                iconOption.className = 'icon-option';
                iconOption.textContent = icon;
                iconOption.onclick = () => selectIcon(icon);
                iconGrid.appendChild(iconOption);
            });
        }
        
        function toggleIconGrid() {
            const iconGrid = document.getElementById('iconGrid');
            if (iconGrid.style.display === 'none') {
                iconGrid.style.display = 'grid';
                initializeIconGrid();
            } else {
                iconGrid.style.display = 'none';
            }
        }
        
        function selectIcon(icon) {
            selectedPersonaIcon = icon;
            selectedIconType = 'emoji';
            
            const iconDisplay = document.getElementById('selectedIcon');
            iconDisplay.innerHTML = icon; // Use innerHTML instead of textContent for emojis
            
            // Update selected state
            document.querySelectorAll('.icon-option').forEach(opt => {
                opt.classList.remove('selected');
                if (opt.textContent === icon) {
                    opt.classList.add('selected');
                }
            });
            
            // Hide grid after selection
            document.getElementById('iconGrid').style.display = 'none';
        }
        
        // Handle image upload
        async function handleImageUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            // Validate file size
            if (file.size > 5 * 1024 * 1024) {
                alert('File size must be less than 5MB');
                return;
            }
            
            // Validate file type
            if (!file.type.startsWith('image/')) {
                alert('Please select an image file');
                return;
            }
            
            const formData = new FormData();
            formData.append('avatar', file);
            
            try {
                const response = await fetch('/api/upload-avatar', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (result.success) {
                    selectedPersonaIcon = result.url;
                    selectedIconType = 'image';
                    
                    const iconDisplay = document.getElementById('selectedIcon');
                    iconDisplay.innerHTML = `<img src="${result.url}" alt="Avatar">`;
                } else {
                    alert('Error uploading image: ' + result.error);
                }
            } catch (error) {
                console.error('Upload error:', error);
                alert('Error uploading image');
            }
        }
        
        // Handle form submission
        document.getElementById('personaForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = {
                name: document.getElementById('personaName').value,
                gender: document.getElementById('personaGender').value,
                icon: selectedPersonaIcon,
                iconType: selectedIconType,
                introduction: document.getElementById('personaIntroduction').value,
                traits: {
                    extraversion: parseInt(document.getElementById('extraversion').value),
                    agreeableness: parseInt(document.getElementById('agreeableness').value),
                    conscientiousness: parseInt(document.getElementById('conscientiousness').value),
                    neuroticism: parseInt(document.getElementById('neuroticism').value),
                    openness: parseInt(document.getElementById('openness').value)
                }
            };
            
            try {
                const response = await fetch('/api/personas', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert('Persona saved successfully!');
                    closeModal();
                    loadPersonas(); // Reload the persona list
                } else {
                    alert('Error saving persona: ' + result.error);
                }
            } catch (error) {
                console.error('Error saving persona:', error);
                alert('Error saving persona: ' + error.message);
            }
        });
        
        // Close modals when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('personaModal');
            const viewModal = document.getElementById('viewModal');
            if (event.target === modal) {
                closeModal();
            }
            if (event.target === viewModal) {
                closeViewModal();
            }
        }
        
        
        // Load personas when page loads
        loadPersonas();
    </script>
</body>
</html>